# プロジェクト要件定義書：アーカイブ探索システム（青空文庫版）

## 1. プロジェクト概要

* **目的**: 「自然言語によるアーカイブ探索」と「情報の信頼性（出典明示）」を実証するデモシステムを構築する。
* **コアバリュー**: 内部アーカイブ（青空文庫）を正としつつ、外部Web情報を「補足・ヒント」として提示することで、研究者のインサイトを深める体験を提供する。

## 2. システム構成（Tech Stack）

| レイヤー | 技術選定 | 備考 |
| --- | --- | --- |
| **LLM** | **Gemini 3.0 Flash (Preview)** | 高速、ロングコンテキスト、マルチモーダル対応のため採用。 |
| **Frontend** | **Next.js + Vercel AI SDK** | UI構築。React Bits / Shadcn UI を使用してデザインを統一。 |
| **Backend** | **Python (FastAPI)** | RAGロジック、検索ルーティング制御。 |
| **Orchestration** | **LangChain / LangGraph** | 検索フローの制御。 |
| **Vector DB** | **ChromaDB** (Local) | アーカイブデータの格納・検索。 |
| **Web Search** | **Exa (formerly Metaphor)** | LLM向けのノイズレスなWeb検索エンジン。 |

## 3. データ戦略

### 3.1. データセット（アーカイブ）

* **処理**: GitHubリポジトリよりテキストを作品を取得する
https://github.com/aozorabunko/aozorabunko

### 3.2. チャンキング戦略（決定事項：B案）

* **粒度**: **大きめ（章・節単位、または 2000~4000 token程度）**。
* **理由**: Gemini Flashのロングコンテキストを活かし、前後の文脈を保持したまま検索させることで、「断片的なキーワード一致」ではなく「文脈的な回答」を実現する。

## 4. 機能要件・ロジックフロー

### 4.1. 検索・生成フロー（決定事項：A案変則版）

1. **ユーザー入力**: 自然言語で質問。
2. **パラレル検索**:
* **内部検索**: Vector DBから関連する「大きなチャンク」を取得。
* **外部検索**: クエリに基づいてExaでWeb検索を実行。


3. **回答生成プロンプト**:
* 「あなたはアーカイブ専門の研究アシスタントです」
* 「**内部データ（Context A）を主たる根拠**として回答を作成してください」
* 「**外部データ（Context B）はあくまで『補足情報』や『一般的定義』**として扱い、回答の後半に『参考情報』としてまとめてください」


4. **レスポンス**: ストリーミングで回答を表示。

### 4.2. UI/UX表現

* **メインエリア（回答）**:
* アーカイブに基づく記述には `[出典: 作品名]` のリンクを付与。
* Webに基づく記述には `[Web参考]` と明記し、スタイルを変える（少し薄くする、枠で囲うなど）。


* **サイドパネル（根拠確認）**:
* 回答内の `[出典]` リンクをクリックすると、サイドパネルに**当該作品のテキスト全文（該当チャンク）**がロードされる。
* 該当箇所が**ハイライト（黄色背景など）**され、自動スクロールする。


* **ビジュアル**:
* チャットボット（右下）ではなく、**「検索エージェント画面」（全画面型）**を採用。

